<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>后台管理系统</title>
<link href="/pay-admin/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/pay-admin/css/londinium-theme.min.css" rel="stylesheet"
	type="text/css">
<link href="/pay-admin/css/styles.min.css" rel="stylesheet" type="text/css">
<link href="/pay-admin/css/icons.min.css" rel="stylesheet" type="text/css">

<script type="text/javascript" src="/pay-admin/js/jquery/1.10.1/jquery.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/jquery/1.10.2/jquery-ui.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/charts/sparkline.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/forms/uniform.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/forms/select2.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/forms/inputmask.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/forms/autosize.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/forms/inputlimit.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/forms/listbox.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/forms/multiselect.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/forms/validate.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/forms/tags.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/forms/switch.min.js"></script>
<script type="text/javascript"
	src="/pay-admin/js/plugins/forms/uploader/plupload.full.min.js"></script>
<script type="text/javascript"
	src="/pay-admin/js/plugins/forms/uploader/plupload.queue.min.js"></script>
<script type="text/javascript"
	src="/pay-admin/js/plugins/interface/daterangepicker.js"></script>
<script type="text/javascript"
	src="/pay-admin/js/plugins/interface/fancybox.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/interface/prettify.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/interface/moment.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/interface/jgrowl.min.js"></script>
<script type="text/javascript"
	src="/pay-admin/js/plugins/interface/datatables.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/plugins/interface/colorpicker.js"></script>
<script type="text/javascript"
	src="/pay-admin/js/plugins/interface/fullcalendar.min.js"></script>
<script type="text/javascript"
	src="/pay-admin/js/plugins/interface/timepicker.min.js"></script>
<script type="text/javascript"
	src="/pay-admin/js/plugins/interface/collapsible.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/pay-admin/js/application.js"></script>
<script type="text/javascript" src="/pay-admin/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="/pay-admin/js/Chart.min.js"></script>
    <style type="text/css">
        body, h1, h2, h3, h4, h5, h6 {
            margin: 0px;
            padding: 0px;
        }

        .container {
            max-width: 1020px;
            margin: 0 auto;
            margin-bottom: 80px;
           /*border: 1px solid red;*/ 
        }

        .chart-wrapper {
            background: #fff;
            padding: 15px;
            max-width: 1020px;
            margin: 0px auto 0px auto;
            box-sizing: border-box;
            /*如果内容被修剪，则浏览器会显示滚动条以便查看其余的内容。*/
            overflow: auto;
        }

        h2 {
            margin: 20px 0px;
        }

        .chart-wrapper canvas {
            min-width: 100%;
            height: 260px;
        }

        .chart-title, .chart-wrapper + small {
            margin-left: 15px;
        }
    </style>
</head>
<body class="sidebar-wide">

	





<!-- Navbar -->
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="navbar-header">
		 
		
		


<a class="navbar-brand" href="/pay-admin/">
	<img id="headerLogoImg" >
</a>

<script>
var hostName = location.hostname;
if('mgr.citywemedia.cn'==hostName){
	document.getElementById("headerLogoImg").setAttribute("src", "/pay-admin/images/logo_citywemedia.png");
}else{
	document.getElementById("headerLogoImg").setAttribute("src", "/pay-admin/images/logo.png");
}
</script>
		
			<a class="sidebar-toggle"><i
			class="icon-paragraph-justify2"></i></a>
		<button type="button" class="navbar-toggle" data-toggle="collapse"
			data-target="#navbar-icons">
			<span class="sr-only">Toggle navbar</span><i class="icon-grid3"></i>
		</button>
		<button type="button" class="navbar-toggle" data-toggle="collapse"
			data-target=".sidebar">
			<span class="sr-only">Toggle navigation</span><i
				class="icon-paragraph-justify2"></i>
		</button>
	</div>
	<ul class="nav navbar-nav navbar-right collapse" id="navbar-icons">
		<li class="user dropdown"><a class="dropdown-toggle"
			data-toggle="dropdown"><img src="/pay-admin/images/demo/users/default_avatar.jpg"
				alt="">
				<span>
					<%= session["nickname"] %>
				</span>
				<i class="caret"></i>
			</a>
		<ul class="dropdown-menu dropdown-menu-right icons-right">
				<li><a href="../profile/profile"><i class="icon-user"></i>
						个人资料</a></li>
				<li><a href="../password/password"><i class="icon-lock"></i>
						修改密码</a></li>
				<li><a href="../login/loginOut"><i class="icon-exit"></i>
						注销</a></li>
			</ul></li>
	</ul>
</div>

<!-- /navbar -->



	<!-- Page container -->
	<div class="page-container">

		












<div class="sidebar collapse">
	<div class="sidebar-content">

		<div class="user-menu dropdown">
			<a href="#"><img src="/pay-admin/images/demo/users/default_avatar.jpg" 
				alt="">
			<div class="user-info">
                <%= session["nickname"] %> <span>管理员</span>
				</div></a>
		</div>


		<!-- Main navigation -->
		<ul class="navigation navigation-icons-left"">
			
		
			<li >
				<a href="#" class="expand" id='second-level'><span>CP应用相关</span>
					<i class="icon-grid"></i></a>
			<ul>
			
				<li><a href="#" >我的应用列表</a></li>

				<li><a href="../myProductPaging/myProductPaging" >我的平台列表</a></li>
                

				<li><a href="/pay-admin/example/signExample" >签名工具</a></li>
			
			</ul>
			</li>
			
		  <li>
                <a href="#" class="expand" id="second-level">
                    <span>数据查询</span>
                    <i class="icon-grid"></i>
                </a>
                <ul>
                     <li><a href="#">统计数据</a></li>
                    <li><a href="../payGameInfo/payGameInfo" >订单查询</a></li>
                   
                </ul>
		    </li>

			<li >
				<a href="#" class="expand" id='second-level'><span>个人中心</span>
					<i class="icon-grid"></i></a>
			<ul>
			
				<li><a href="../profile/profile" >个人信息</a></li>
			
				<li><a href="../index/index" >首页</a></li>
			
			</ul>
			</li>
			
		</ul>
		<!-- /main navigation -->
	</div>
</div>

		<!-- Page content -->
		<div class="page-content">
			<!-- Page header -->
			<div class="page-header">
				<div class="page-title">
					<h3>
					  统计
						<!-- 
						<small>Headings, lists, code, pre etc. </small>
						 -->
					</h3>
				</div>
			</div>
			<!-- /page header -->
			<!-- Breadcrumbs line -->
			<div class="breadcrumb-line">
				<ul class="breadcrumb">
					<li><a href="../index/index">首页</a></li>
					<li class="active">统计</li>
				</ul>
				<div class="visible-xs breadcrumb-toggle">
					<a class="btn btn-link btn-lg btn-icon" data-toggle="collapse"
						data-target=".breadcrumb-buttons"><i class="icon-menu2"></i></a>
				</div>
			</div>
			<!-- /breadcrumbs line -->
			
			
			<form id="validate" action="../alllist/alllist" method="post" >
				<!-- Basic inputs -->
				<div class="panel panel-default">
					<div class="panel-heading">
						<h6 class="panel-title">
							<i class="icon-bubble4"></i>条件筛选
						</h6>
					</div>
					<div class="panel-body"> 
						<div class="form-group">
							<div class="row">
								<div class="col-md-3">
									<label>游戏名称:</label>
                                    <select name="game" class="form-control">
                                        <% games.forEach(function(data){%>
											<% if(data['selected']){%>
                                        		<option value="<%= data['name'] %>" selected="selected"><%= data["name2"]%></option>
											<%}else{%>
												<option value="<%= data['name'] %>"><%= data["name2"]%></option>
											<%}%>
                                        <%})%>
                                    </select>
								</div>
                                
                                <div class="col-md-3">
									<label>平台名称:</label>
                                    <select name="platform" class="form-control">
                                        <%platforms.forEach(function(data){%>
											<% if(data['selected']){%>
                                        		<option value="<%= data['name'] %>" selected="selected"><%= data["name2"]%></option>
											<%}else{%>
												<option value="<%= data['name'] %>"><%= data["name2"]%></option>
											<%}%>
                                        <%})%>
                                    </select>
								</div>
                                
                                <div class="col-md-3">
                                <label>日期区间:</label><br/>
                        <input id="d5221" class="Wdate" border-color:"#ddd"" type="text" name="time1" value="<%= time1%>"  onFocus="var d5222=$dp.$('d5222');WdatePicker({onpicked:function(){d5222.focus();},maxDate:'#F{$dp.$D(\'d5222\')}'})"/>
                       至
                       <input id="d5222" class="Wdate" type="text" name="time2" value="<%= time2%>" onFocus="WdatePicker({minDate:'#F{$dp.$D(\'d5221\')}'})"/>
                                </div>
							</div>
						</div>
					
						<div class="form-actions text-center">
							<input type="submit" value="查 询" class="btn btn-primary btn-sm"> 
							<input type="reset" value="重 置" class="btn btn-default btn-sm">
						</div>
					</div>
				</div>
			</form>
			
			<div class="container">
                <h2 class="chart-title">新增及活跃人数</h2>
                <div class="chart-wrapper">
                    <canvas id="sales-volume-chart"></canvas>
                    <small>单位:人</small>
                </div>
            </div>

			<!-- Table view -->
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h5 class="panel-title">
                        <i class="icon-people"></i>明细数据
                    </h5>
                    <a href="../../<%= xlsx%>"><span class="label label-danger pull-right">下载</span></a>
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-striped dataTable">
                        <thead>
                            <tr>
                                <th>日期</th>
                                <th>新增用户数</th>
                                <th>活跃用户数</th>
                                <th>次日留存率</th>
                                <th>7日留存率</th>
                                <th>30日留存率</th>
                                <th>付费人数</th>
                                <th>付费次数</th>
                                <th>付费金额</th>
                                <th>新增ARPU</th>
                                <th>活跃ARPU</th>
                                <th>付费ARPU</th>
                            </tr>
                        </thead>
						<tbody>
						<% list.forEach(function(data){ 
							%>
						<tr>
							<td><%= data["time"].toString('yyyy-MM-dd')%></td>
							<td><%= data["born"]%></td>
							<td><%= data["active"]%></td>
							
							<td><%= data["awk1"].toFixed(2)%></td>
							<td><%= data["awk7"].toFixed(2)%></td>
							<td><%= data["awk30"].toFixed(2)%></td>
							
							<td><%= data["pay_people"]%></td>
							<td><%= data["pay_count"]%></td>
							<td><%= data["pay_money"]%></td>
							
							<td><%= data["born_arpu"].toFixed(2)%></td>
							<td><%= data["active_arpu"].toFixed(2)%></td>
							<td><%= data["pay_arpu"].toFixed(2)%></td>
						</tr>
						<% }) %>
						</tbody>
                    </table>
                </div>
            </div>
             

<div class="footer clearfix">
	<div class="pull-right icons-group">
		<a href="javascript:void(0)"><i class="icon-screen2"></i></a> <a
			href="javascript:void(0)"><i class="icon-balance"></i></a> <a
			href="javascript:void(0)"><i class="icon-cog3"></i></a>
	</div>
</div>
<!-- /footer -->

		</div>
		<!-- /page content -->
	</div>
	<!-- /page container -->

	            <script type="text/javascript">
            function lineChart() {
                var ctx = document.getElementById('sales-volume-chart').getContext("2d");
				var labels =  "<%= list.reverse().map(x=>x.time.toString('yyyy-MM-dd').substr(8, 2)) %>".split(',');
				var data1 =  "<%= list.map(x=>x.active); %>".split(',');
				var data2 =  "<%= list.map(x=>x.born); %>".split(',');
                var data = {
                    labels : labels,
					datasets : [
						{
							fillColor : "rgba(220,220,220,0.5)",
							strokeColor : "rgba(220,220,220,1)",
							pointColor : "rgba(220,220,220,1)",
							pointStrokeColor : "#fff",
							data: data1
						},
						{
							fillColor : "rgba(151,187,205,0.5)",
							strokeColor : "rgba(151,187,205,1)",
							pointColor : "rgba(151,187,205,1)",
							pointStrokeColor : "#fff",
							data: data2
						}
					]
                };
                var allPriceChart = new Chart(ctx).Line(data, {
                    // 折线的曲线过渡，0是直线，默认0.4是曲线
                    // tooltipCornerRadius: 0,
                    // bezierCurveTension: 0,
                    // // 关闭曲线功能
                    // bezierCurve: false,
                    // scaleOverride: false,
                    // // scaleSteps: 9.5,
                    // // scaleStepWidth:1,
                    // // scaleStartValue:0
                });
            }
			lineChart();
			</script>
</body>
</html>
